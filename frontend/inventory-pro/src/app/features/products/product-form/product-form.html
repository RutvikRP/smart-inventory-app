<div class="container mx-auto px-6 py-8 max-w-4xl">

  <!-- Header -->
  <div class="mb-6">
    <div class="flex items-center space-x-2 mb-2">
      <button (click)="onCancel()" class="p-2 rounded-lg transition-all" style="color: var(--color-text-secondary);">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
      </button>
      <h1 class="text-3xl font-bold" style="color: var(--color-text-primary);">
        {{ isEditMode() ? 'Edit Product' : 'Add New Product' }}
      </h1>
    </div>
    <p class="text-sm" style="color: var(--color-text-secondary);">
      {{ isEditMode() ? 'Update product information' : 'Fill in the details to create a new product' }}
    </p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading()" class="card">
    <div class="card-body flex items-center justify-center py-12">
      <div class="flex flex-col items-center space-y-4">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2" style="border-color: var(--color-primary-600);">
        </div>
        <p class="text-sm" style="color: var(--color-text-secondary);">Loading product...</p>
      </div>
    </div>
  </div>

  <!-- Error Alert -->
  <div *ngIf="error()" class="mb-6 p-4 rounded-lg flex items-start space-x-3"
    style="background-color: var(--color-error-50); border: 1px solid var(--color-error-200);">
    <svg class="w-5 h-5 flex-shrink-0 mt-0.5" style="color: var(--color-error-600);" fill="none" stroke="currentColor"
      viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <div class="flex-1">
      <h3 class="font-medium" style="color: var(--color-error-800);">Error</h3>
      <p class="text-sm mt-1" style="color: var(--color-error-700);">{{ error() }}</p>
    </div>
    <button (click)="error.set(null)" style="color: var(--color-error-600);">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>

  <!-- Form -->
  <form *ngIf="!loading()" [formGroup]="productForm" (ngSubmit)="onSubmit()">

    <div class="card mb-6">
      <div class="card-header">
        <h2 class="text-lg font-semibold" style="color: var(--color-text-primary);">
          Product Information
        </h2>
      </div>
      <div class="card-body">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

          <!-- Product Name -->
          <div class="md:col-span-2">
            <label for="name" class="block text-sm font-medium mb-2" style="color: var(--color-text-secondary);">
              Product Name <span style="color: var(--color-error-500);">*</span>
            </label>
            <input type="text" id="name" formControlName="name" placeholder="Enter product name" class="input-field"
              [class.border-error]="isFieldInvalid('name')">
            <p *ngIf="isFieldInvalid('name')" class="mt-1 text-xs" style="color: var(--color-error-600);">
              {{ getFieldError('name') }}
            </p>
          </div>

          <!-- SKU -->
          <div>
            <label for="sku" class="block text-sm font-medium mb-2" style="color: var(--color-text-secondary);">
              SKU <span style="color: var(--color-error-500);">*</span>
            </label>
            <div class="flex space-x-2">
              <input type="text" id="sku" formControlName="sku" placeholder="Enter SKU" class="input-field flex-1"
                [class.border-error]="isFieldInvalid('sku')">
              <button type="button" (click)="generateSKU()" class="btn-outline px-3" title="Generate SKU">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
              </button>
            </div>
            <p *ngIf="isFieldInvalid('sku')" class="mt-1 text-xs" style="color: var(--color-error-600);">
              {{ getFieldError('sku') }}
            </p>
          </div>

          <!-- Unit of Measure -->
          <div>
            <label for="uom" class="block text-sm font-medium mb-2" style="color: var(--color-text-secondary);">
              Unit of Measure <span style="color: var(--color-error-500);">*</span>
            </label>
            <select id="uom" formControlName="uom" class="input-field" [class.border-error]="isFieldInvalid('uom')">
              <option value="" disabled>Select unit</option>
              <option *ngFor="let uom of uomOptions" [value]="uom">{{ uom }}</option>
            </select>
            <p *ngIf="isFieldInvalid('uom')" class="mt-1 text-xs" style="color: var(--color-error-600);">
              {{ getFieldError('uom') }}
            </p>
          </div>

          <!-- Price -->
          <div>
            <label for="price" class="block text-sm font-medium mb-2" style="color: var(--color-text-secondary);">
              Price (₹) <span style="color: var(--color-error-500);">*</span>
            </label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-sm"
                style="color: var(--color-text-tertiary);">
                ₹
              </span>
              <input type="number" id="price" formControlName="price" placeholder="0.00" step="0.01" min="0"
                class="input-field pl-8" [class.border-error]="isFieldInvalid('price')">
            </div>
            <p *ngIf="isFieldInvalid('price')" class="mt-1 text-xs" style="color: var(--color-error-600);">
              {{ getFieldError('price') }}
            </p>
          </div>

          <!-- Quantity -->
          <div>
            <label for="quantity" class="block text-sm font-medium mb-2" style="color: var(--color-text-secondary);">
              Initial Quantity <span style="color: var(--color-error-500);">*</span>
            </label>
            <input type="number" id="quantity" formControlName="quantity" placeholder="0" min="0" class="input-field"
              [class.border-error]="isFieldInvalid('quantity')">
            <p *ngIf="isFieldInvalid('quantity')" class="mt-1 text-xs" style="color: var(--color-error-600);">
              {{ getFieldError('quantity') }}
            </p>
          </div>

          <!-- Description -->
          <div class="md:col-span-2">
            <label for="description" class="block text-sm font-medium mb-2" style="color: var(--color-text-secondary);">
              Description
            </label>
            <textarea id="description" formControlName="description" rows="4"
              placeholder="Enter product description (optional)" class="input-field resize-none"
              [class.border-error]="isFieldInvalid('description')"></textarea>
            <p class="mt-1 text-xs" style="color: var(--color-text-tertiary);">
              {{ productForm.get('description')?.value?.length || 0 }}/500 characters
            </p>
            <p *ngIf="isFieldInvalid('description')" class="mt-1 text-xs" style="color: var(--color-error-600);">
              {{ getFieldError('description') }}
            </p>
          </div>

        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="flex items-center justify-end space-x-4">
      <button type="button" (click)="onCancel()" class="btn-outline" [disabled]="submitting()">
        Cancel
      </button>
      <button type="submit" class="btn-primary flex items-center space-x-2"
        [disabled]="submitting() || productForm.invalid">
        <span *ngIf="!submitting()">
          {{ isEditMode() ? 'Update Product' : 'Create Product' }}
        </span>
        <span *ngIf="submitting()" class="flex items-center space-x-2">
          <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
          <span>{{ isEditMode() ? 'Updating...' : 'Creating...' }}</span>
        </span>
      </button>
    </div>

  </form>

</div>